<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Running the pipeline | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing</title>
  <meta name="description" content="Chapter 5 Running the pipeline | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Running the pipeline | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Running the pipeline | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing" />
  
  
  



<meta name="date" content="2022-05-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-preparation.html"/>
<link rel="next" href="results.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RNASequest</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>3</b> Installation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="installation.html"><a href="installation.html#install-scrnasequest"><i class="fa fa-check"></i><b>3.1</b> Install scRNASequest</a></li>
<li class="chapter" data-level="3.2" data-path="installation.html"><a href="installation.html#install-celldepot"><i class="fa fa-check"></i><b>3.2</b> Install CellDepot</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>4</b> Data preparation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-preparation.html"><a href="data-preparation.html#public-data-in-h5-format"><i class="fa fa-check"></i><b>4.1</b> Public data in h5 format</a></li>
<li class="chapter" data-level="4.2" data-path="data-preparation.html"><a href="data-preparation.html#public-data-in-10x-mtx-format"><i class="fa fa-check"></i><b>4.2</b> Public data in 10X mtx format</a></li>
<li class="chapter" data-level="4.3" data-path="data-preparation.html"><a href="data-preparation.html#self-prepared-files"><i class="fa fa-check"></i><b>4.3</b> Self-prepared files</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html"><i class="fa fa-check"></i><b>5</b> Running the pipeline</a>
<ul>
<li class="chapter" data-level="5.1" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#prepare-the-config.yml-file"><i class="fa fa-check"></i><b>5.1</b> Prepare the config.yml file</a></li>
<li class="chapter" data-level="5.2" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#prepare-the-sample-meta-file"><i class="fa fa-check"></i><b>5.2</b> Prepare the sample meta file</a></li>
<li class="chapter" data-level="5.3" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#prepare-the-comparison-file"><i class="fa fa-check"></i><b>5.3</b> Prepare the comparison file</a></li>
<li class="chapter" data-level="5.4" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#file-hierarchy"><i class="fa fa-check"></i><b>5.4</b> File hierarchy</a></li>
<li class="chapter" data-level="5.5" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#scanalyzer"><i class="fa fa-check"></i><b>5.5</b> scAnalyzer</a></li>
<li class="chapter" data-level="5.6" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#scref"><i class="fa fa-check"></i><b>5.6</b> scRef</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>6</b> Results</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="running-the-pipeline" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Running the pipeline</h1>
<p>First, make sure the .env has been created in the src folder under the pipeline directory:</p>
<pre><code>ls ~/scRNAsequest/src/.env</code></pre>
<div id="prepare-the-config.yml-file" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Prepare the config.yml file</h2>
<p>To run the scRNAsequest pipeline, a config.yml file is required to fill in. Please use the following template as an example to prepare this file:</p>
<pre><code>prj_name: E-MTAB-11115 #required
prj_title: Cell2location maps fine-grained cell types in spatial transcriptomics #required # quote might be needed
ref_name: # This is optional. You can choose one from scAnalyzer call without argument
output: /home/ysun4/E-MTAB-11115/processing #output path
sample_name: Sample_Name
sample_meta: /home/ysun4/E-MTAB-11115/processing/sampleMeta.csv
MTstring: &quot;&quot; #default search &quot;MT-&quot;, &quot;Mt-&quot; and &quot;mt-&quot;
rmMT: True
min.cells: 0 #filtering genes by minimal cell
min.features: 0 #filtering cells by minimal genes
mt.cutoff: 100 # any cells with higher MT percentage to be removed
highCount.cutoff: 1000000 # any cells with higher total counts to be removed
highGene.cutoff: 300000 # any cells with higher number of detected genes to be removed
group: #if provided, a 10X QC box plot will be ploted in QC plot
runAnalysis: False
newProcess: False
parallel: sge #&quot;sge&quot; or &quot;slurm&quot;
core: 4
overwrite: False
#parallelTime: 180 # for a job (not the entire pipeline) in minutes, default 3hr

## DEG analysis for an annotation (such as disease vs health) within a cell type annotation
DEG_desp:  #required if you would like to perform DEG analysis. Leaving this empty won&#39;t cause error.
# Please be causion of changing the following default filtering
min.cells.per.gene: 3
min.genes.per.cell: 250
min.perc.cells.per.gene: 0.00
perc_filter: TRUE
R6_min.cells.per.gene: 3
R6_min.perc.cells.per.gene: 0.1
R6_min.cells.per.gene.type: &quot;or&quot;
R6_cells.per.gene.filter: TRUE
R6_perc.cells.filter: TRUE
R6_perc.filter: FALSE
R6_perc.filter.type: &quot;and&quot;
R6_perc_threshold: 0.90
R6_min.ave.pseudo.bulk.cpm: 1
R6_pseudo.bulk.cpm.filter: FALSE
R6_min.cells.per.subj: 3

## publish to celldepot
publish: False</code></pre>
<p>In the first run (see the below scAnalyzer section on how to run the pipeline), the user can set <code>runAnalysis: False</code> and use the above default parameters to perform cell filtering and QC.</p>
<p>Then this pipeline will only run basic QC checking and output a Bookdown report with QC figures. This step is semi-automated because different dataset may need distinct filtering criteria. The design of this pipeline is to pause here to make sure the filtering step is adequate before running through the whole analysis.</p>
<p>Once the filtering step is validated by checking the QC report, the user can change the following settings and run the full analysis:</p>
<pre><code>runAnalysis: True
overwrite: True</code></pre>
</div>
<div id="prepare-the-sample-meta-file" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Prepare the sample meta file</h2>
<p>Another important file in the sample meta file, a csv file storing data information. Usually it is named as sampleMeta.csv</p>
<p>Here is an example with minimal information for the public dataset (for 10X h5 data):</p>
<pre><code>Sample_Name,h5path,metapath
5705STDY8058280,~/E-MTAB-11115/data/5705STDY8058280_filtered_feature_bc_matrix.h5,~/E-MTAB-11115/data/5705STDY8058280_annotation.csv
5705STDY8058281,~/E-MTAB-11115/data/5705STDY8058281_filtered_feature_bc_matrix.h5,~/E-MTAB-11115/data/5705STDY8058281_annotation.csv
5705STDY8058282,~/E-MTAB-11115/data/5705STDY8058282_filtered_feature_bc_matrix.h5,~/E-MTAB-11115/data/5705STDY8058282_annotation.csv
5705STDY8058283,~/E-MTAB-11115/data/5705STDY8058283_filtered_feature_bc_matrix.h5,~/E-MTAB-11115/data/5705STDY8058283_annotation.csv
5705STDY8058284,~/E-MTAB-11115/data/5705STDY8058284_filtered_feature_bc_matrix.h5,~/E-MTAB-11115/data/5705STDY8058284_annotation.csv
5705STDY8058285,~/E-MTAB-11115/data/5705STDY8058285_filtered_feature_bc_matrix.h5,~/E-MTAB-11115/data/5705STDY8058285_annotation.csv</code></pre>
</div>
<div id="prepare-the-comparison-file" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Prepare the comparison file</h2>
<p>This file is critical for the differential expressed gene (DEG) analysis.</p>
<p>In the DEG comparison file, “sample”, “cluster”, “group” and “covars” are the annotation headers, and “alt” and “ref” are the entries from “group” column.</p>
<p>The DEG is performing between “alt” and “ref” cells from “group” within each entry of “cluster” considering “sample” variations</p>
<p>Here is an example of the DEG comparison file called DEGinfo.csv:</p>
<pre><code>sample,cluster,group,alt,ref,covars[+ separated],method[default NEBULA],model[default HL]

#####To be added</code></pre>
<p>Once the DEGinfo.csv file created, it can be added to the config.yml file:</p>
<pre><code>DEG_desp: ~/E-MTAB-11115/processing/DEGinfo.csv</code></pre>
</div>
<div id="file-hierarchy" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> File hierarchy</h2>
<p>After downloading the files, usually we save them in the ./data folder. For the config.yml and the sample meta files, we saved them into another folder.</p>
<p>For data downloaded in 10X h5 format:</p>
<pre><code>E-MTAB-11115/
    ├── data
        ├── 5705STDY8058280_annotation.csv
        ├── 5705STDY8058280_raw_feature_bc_matrix.h5
        ├── 5705STDY8058281_annotation.csv
        ├── 5705STDY8058281_raw_feature_bc_matrix.h5
        ...
    ├── processing
        ├── config.yml
        ├── DEGinfo.csv
        └── sampleMeta.csv</code></pre>
<p>For data downloaded in 10X mtx format:</p>
<pre><code>########To be added</code></pre>
</div>
<div id="scanalyzer" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> scAnalyzer</h2>
<p>To run scAnalyzer, the user can pass the path to the config.yml file to the program. This command can be executed at anywhere on the computer.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="running-the-pipeline.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scAnalyzer</span> Path/to/a/config/file</span>
<span id="cb19-2"><a href="running-the-pipeline.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="running-the-pipeline.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Example:</span></span>
<span id="cb19-4"><a href="running-the-pipeline.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">scAnalyzer</span> ~/E-MTAB-11115/processing/config.yml</span></code></pre></div>
<p>The output files will be stored in the location designated in the config.yml.</p>
</div>
<div id="scref" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> scRef</h2>
<p>This pipeline is used to process the current data and add it to the reference. Please be cautious about the following two things:</p>
<ul>
<li>This process will add a Seurat reference data into the scRNAsequest pipeline PERMANENTLY!</li>
<li>Please make sure the data provided for reference building is SCT transformed!</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="running-the-pipeline.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scRef</span> Path/to/a/config/file</span>
<span id="cb20-2"><a href="running-the-pipeline.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="running-the-pipeline.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Example:</span></span>
<span id="cb20-4"><a href="running-the-pipeline.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">scRef</span> ~/E-MTAB-11115/processing/config.yml</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-preparation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/interactivereport/scRNAsequest/edit/gh-pages/05-RunningThePipeline.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/interactivereport/scRNAsequest/blob/gh-pages/05-RunningThePipeline.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
