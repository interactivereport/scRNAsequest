<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Differential expression (DE) analysis | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing</title>
  <meta name="description" content="Chapter 7 Differential expression (DE) analysis | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Differential expression (DE) analysis | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Differential expression (DE) analysis | scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing" />
  
  
  



<meta name="date" content="2022-06-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="running-the-pipeline.html"/>
<link rel="next" href="reference-building.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">scRNASequest</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>3</b> Installation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="installation.html"><a href="installation.html#install-scrnasequest"><i class="fa fa-check"></i><b>3.1</b> Install scRNASequest</a></li>
<li class="chapter" data-level="3.2" data-path="installation.html"><a href="installation.html#install-cellxgene_vip"><i class="fa fa-check"></i><b>3.2</b> Install cellxgene_VIP</a></li>
<li class="chapter" data-level="3.3" data-path="installation.html"><a href="installation.html#install-celldepot"><i class="fa fa-check"></i><b>3.3</b> Install CellDepot</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>4</b> Data preparation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-preparation.html"><a href="data-preparation.html#public-data-in-h5-format"><i class="fa fa-check"></i><b>4.1</b> Public data in h5 format</a></li>
<li class="chapter" data-level="4.2" data-path="data-preparation.html"><a href="data-preparation.html#public-data-in-10x-mex-format"><i class="fa fa-check"></i><b>4.2</b> Public data in 10X MEX format</a></li>
<li class="chapter" data-level="4.3" data-path="data-preparation.html"><a href="data-preparation.html#self-prepared-files"><i class="fa fa-check"></i><b>4.3</b> Self-prepared files</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="input-configuration.html"><a href="input-configuration.html"><i class="fa fa-check"></i><b>5</b> Input configuration</a>
<ul>
<li class="chapter" data-level="5.1" data-path="input-configuration.html"><a href="input-configuration.html#prepare-the-config.yml-file"><i class="fa fa-check"></i><b>5.1</b> Prepare the config.yml file</a></li>
<li class="chapter" data-level="5.2" data-path="input-configuration.html"><a href="input-configuration.html#section52"><i class="fa fa-check"></i><b>5.2</b> Prepare the sample meta file</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="input-configuration.html"><a href="input-configuration.html#h5-input"><i class="fa fa-check"></i><b>5.2.1</b> h5 input</a></li>
<li class="chapter" data-level="5.2.2" data-path="input-configuration.html"><a href="input-configuration.html#mex-input"><i class="fa fa-check"></i><b>5.2.2</b> MEX input</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="input-configuration.html"><a href="input-configuration.html#file-hierarchy"><i class="fa fa-check"></i><b>5.3</b> File hierarchy</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html"><i class="fa fa-check"></i><b>6</b> Running the pipeline</a>
<ul>
<li class="chapter" data-level="6.1" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#initial-scanalyzer-run"><i class="fa fa-check"></i><b>6.1</b> Initial scAnalyzer run</a></li>
<li class="chapter" data-level="6.2" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#review-the-bookdown-report"><i class="fa fa-check"></i><b>6.2</b> Review the bookdown report</a></li>
<li class="chapter" data-level="6.3" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#run-the-full-analysis"><i class="fa fa-check"></i><b>6.3</b> Run the full analysis</a></li>
<li class="chapter" data-level="6.4" data-path="running-the-pipeline.html"><a href="running-the-pipeline.html#visualize-the-harmonized-results"><i class="fa fa-check"></i><b>6.4</b> Visualize the harmonized results</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="differential-expression-de-analysis.html"><a href="differential-expression-de-analysis.html"><i class="fa fa-check"></i><b>7</b> Differential expression (DE) analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="differential-expression-de-analysis.html"><a href="differential-expression-de-analysis.html#example-1"><i class="fa fa-check"></i><b>7.1</b> Example 1</a></li>
<li class="chapter" data-level="7.2" data-path="differential-expression-de-analysis.html"><a href="differential-expression-de-analysis.html#example-2"><i class="fa fa-check"></i><b>7.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="reference-building.html"><a href="reference-building.html"><i class="fa fa-check"></i><b>8</b> Reference Building</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">scRNASequest: an ecosystem of scRNA-seq analysis, visualization and publishing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="differential-expression-de-analysis" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Differential expression (DE) analysis</h1>
<p>Another critical function of the scRNASequest pipeline is the <strong>Differential expression (DE)</strong> analysis. By running the steps in Section 6: <a href="running-the-pipeline.html#running-the-pipeline">Running the pipeline</a>, we have performed quality control of the data, and generated an integrated dataset.</p>
<p>Before running the DE analysis, the <strong>DEGinfo.csv</strong> comparison file needs to be prepared:</p>
<p><a href="https://interactivereport.github.io/scRNAsequest/tutorial/images/DEG_empty.png"><img src="https://interactivereport.github.io/scRNAsequest/tutorial/images/DEG_empty.png" /></a></p>
<p>In the DEG comparison file above, <strong>“sample”</strong>, <strong>“cluster”</strong>, <strong>“group”</strong> and <strong>“covars”</strong> are the annotation headers, and <strong>“alt”</strong> and <strong>“ref”</strong> are the two entries from <strong>“group”</strong> column. The <strong>“covars”</strong> is optional and can be empty.</p>
<p>The DEG is performing between <strong>“alt”</strong> and <strong>“ref”</strong> cells from <strong>“group”</strong> within each entry of <strong>“cluster”</strong> considering <strong>“sample”</strong> variations. The <strong>“group”</strong> variable should contain conditions to compare, such as Mutant v.s. Control. Thus, this pipeline is designed to loop through each cluster, and perform DEG analysis between <strong>“alt”</strong> v.s. <strong>“ref”</strong>.</p>
<p>Here, this tutorial provides several examples to illustrate the DE analysis in scRNASequest:</p>
<p>We use a UMAP with label transferred cell type annotation as an example dataset. Label transfer is strongly suggested if you would like to run DE analysis because the clusters are more meaningful than the original clusters assigned by the software:</p>
<p><a href="https://interactivereport.github.io/scRNAsequest/tutorial/images/UMAP.png"><img src="https://interactivereport.github.io/scRNAsequest/tutorial/images/UMAP.png" /></a></p>
<div id="example-1" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Example 1</h2>
<p>In the first example, we would like to run DE analysis between <strong>‘Female’</strong> and <strong>‘Male’</strong> for each cluster annotated by <strong>predicted.celltype1</strong>. In the first column, we input the header name <strong>library_id</strong>, which annotates the data sources. Then we add <strong>predicted.celltype1</strong> in the <em>cluster</em> column, which allows the pipeline to loop through each cluster in <strong>predicted.celltype1</strong>. The <em>group</em> column contains the header name storing the comparison groups, and here we use the <strong>Sex</strong> annotation. Each time, the pipeline can only compare two conditions, such as <strong>‘Female’</strong> and <strong>‘Male’</strong>. If the <em>group</em> column contains more groups, please list them in multiple lines in the DEGinfo.csv file.</p>
<p>We can also add <em>covars</em> if needed, but this is optional.</p>
<p>The default DE analysis is performed by <a href="https://www.nature.com/articles/s42003-021-02146-6" target="_blank"><strong>NEBULA</strong></a>. As for the model, NEBULA provides two choices: <strong>HL</strong> and <strong>LN</strong>. For more details about them, please refer to the <a href="https://cran.r-project.org/web/packages/nebula/vignettes/nebula_example.html#difference-between-nebula-ln-and-nebula-hl" target="_blank">NEBULA manual</a>.</p>
<p>Here is the DEGinfo.csv we described above:</p>
<pre><code>sample,cluster,group,alt,ref,covars[+ separated],method[default NEBULA],model[default HL]
library_id,predicted.celltype1,Sex,Female,Male,,NEBULA,HL</code></pre>
<p>After preparing the DEGinfo.csv file, simply add it to the config.yml file:</p>
<pre><code>DEG_desp: ~/E-MTAB-11115/processing/DEGinfo.csv</code></pre>
<p>Then rerun the pipeline. The pipeline won’t run the previous steps (i.e. filtering, harmonization, etc.) again, so it will directly run the DE analysis based on the harmonized h5ad file.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="differential-expression-de-analysis.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scAnalyzer</span> Path/to/a/config/file</span>
<span id="cb30-2"><a href="differential-expression-de-analysis.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="differential-expression-de-analysis.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Example:</span></span>
<span id="cb30-4"><a href="differential-expression-de-analysis.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">scAnalyzer</span> ~/E-MTAB-11115/processing/config.yml</span></code></pre></div>
<p>This step may take a few hours to run. The output files will be generated in the directory:</p>
<pre><code>outputdir
    ... previous results         #Omitted, see section 6.4
    ├── ProjName_scDEG           #Folder containing DEG results
      ├── deg6601_predicted.celltype1_Sex_NEBULA_HL
        ├── Female.vs.Male_predicted.celltype1:astrocytes_NEBULA.csv    #Each comparison has three associated files
        ├── Female.vs.Male_predicted.celltype1:astrocytes_NEBULA.png
        ├── Female.vs.Male_predicted.celltype1:astrocytes_NEBULA.QC.pdf
        ├── Female.vs.Male_predicted.celltype1:discarded_NEBULA.csv
        ├── Female.vs.Male_predicted.celltype1:discarded_NEBULA.png
        ├── Female.vs.Male_predicted.celltype1:discarded_NEBULA.QC.pdf
        ...
        ├── env.rds
    ├── ProjName_scDEG.cmd.json
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_astrocytes_Female_Male.error  #Standard error messages
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_meninges_schwann_Female_Male.error
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_microglia_Female_Male.error
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_discarded_Female_Male.error
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_endo_vascular_Female_Male.error
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_neurons_Female_Male.error
    ├── deg6601_predicted.celltype1_Sex_NEBULA_HL_OPC_Female_Male.error
    └── ProjName_scDEG.db</code></pre>
<p>An example of the DE csv table (Female.vs.Male_predicted.celltype1/astrocytes_NEBULA.csv, top 5 rows):</p>
<p>In the table below, the most significant gene is <a href="https://www.ncbi.nlm.nih.gov/gene/7503" target="_blank">Xist</a>, a well-known X-chromosome gene highly expressed in female.</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-7">Table 7.1: </span>DEG analysis of Female.vs.Male in astrocytes
</caption>
<thead>
<tr>
<th style="text-align:center;">
res.tab.ID
</th>
<th style="text-align:center;">
res.tab.log2FC
</th>
<th style="text-align:center;">
res.tab.Pvalue
</th>
<th style="text-align:center;">
res.tab.FDR
</th>
<th style="text-align:center;">
res.tab.algorithm
</th>
<th style="text-align:center;">
res.tab.convergence
</th>
<th style="text-align:center;">
res.tab.metric
</th>
<th style="text-align:center;">
res.ls.summary.logFC_.Intercept.
</th>
<th style="text-align:center;">
res.ls.summary.logFC_.GrouPalt
</th>
<th style="text-align:center;">
res.ls.summary.se_.Intercept.
</th>
<th style="text-align:center;">
res.ls.summary.se_.GrouPalt
</th>
<th style="text-align:center;">
res.ls.summary.p_.Intercept.
</th>
<th style="text-align:center;">
res.ls.summary.p_.GrouPalt
</th>
<th style="text-align:center;">
res.ls.summary.gene_id
</th>
<th style="text-align:center;">
res.ls.summary.gene
</th>
<th style="text-align:center;">
res.ls.overdispersion.Subject
</th>
<th style="text-align:center;">
res.ls.overdispersion.Cell
</th>
<th style="text-align:center;">
res.ls.convergence
</th>
<th style="text-align:center;">
res.ls.algorithm
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Xist
</td>
<td style="text-align:center;">
9.676171
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
6115.1780
</td>
<td style="text-align:center;">
-6.693213
</td>
<td style="text-align:center;">
0.1276737
</td>
<td style="text-align:center;">
0.0234622
</td>
<td style="text-align:center;">
0.0469395
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0065289
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Rgs20
</td>
<td style="text-align:center;">
0.0016728
</td>
<td style="text-align:center;">
0.4393152
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Pnpla7
</td>
<td style="text-align:center;">
-1.230034
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1653.1553
</td>
<td style="text-align:center;">
-9.321192
</td>
<td style="text-align:center;">
-0.1694550
</td>
<td style="text-align:center;">
0.0534180
</td>
<td style="text-align:center;">
0.1065177
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.1116405
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Atp6v1h
</td>
<td style="text-align:center;">
0.0064320
</td>
<td style="text-align:center;">
0.3327316
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Etnppl
</td>
<td style="text-align:center;">
-1.592058
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
525.8328
</td>
<td style="text-align:center;">
-8.511808
</td>
<td style="text-align:center;">
0.0917939
</td>
<td style="text-align:center;">
0.0282832
</td>
<td style="text-align:center;">
0.0565059
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.1042691
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
Rb1cc1
</td>
<td style="text-align:center;">
0.0001000
</td>
<td style="text-align:center;">
0.1725113
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Zbtb16
</td>
<td style="text-align:center;">
-1.448309
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1260.9518
</td>
<td style="text-align:center;">
-9.896064
</td>
<td style="text-align:center;">
-0.0918014
</td>
<td style="text-align:center;">
0.0584728
</td>
<td style="text-align:center;">
0.1165549
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.4309170
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4732440D04Rik
</td>
<td style="text-align:center;">
0.0014745
</td>
<td style="text-align:center;">
0.7288504
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Sorcs2
</td>
<td style="text-align:center;">
1.137956
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1398.0881
</td>
<td style="text-align:center;">
-8.573613
</td>
<td style="text-align:center;">
-0.2252848
</td>
<td style="text-align:center;">
0.0303869
</td>
<td style="text-align:center;">
0.0604625
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0001945
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
Pcmtd1
</td>
<td style="text-align:center;">
0.0001000
</td>
<td style="text-align:center;">
0.3502587
</td>
<td style="text-align:center;">
-10
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
</tbody>
</table>
</div>
<p>An example of the DE png file (Female.vs.Male_predicted.celltype1/astrocytes_NEBULA.png):</p>
<p><a href="https://interactivereport.github.io/scRNAsequest/tutorial/images/DEG_Female_vs_Male_Astrocytes.png"><img src="https://interactivereport.github.io/scRNAsequest/tutorial/images/DEG_Female_vs_Male_Astrocytes.png" /></a></p>
</div>
<div id="example-2" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Example 2</h2>
<p>In the second example, we are going to show how to perform DE analysis directly on two cell types. To achieve this, we added one artificial column (called ‘SelectAll’) in the sampleMeta.csv file, and assigned the same values (‘Everything’) to all the data:</p>
<pre><code>Sample_Name,h5path,Sex,SelectAll
5705STDY8058280,/home/ysun4/testSinglecell/ExternalData/5705STDY8058280_filtered_feature_bc_matrix.h5,Female,Everything
5705STDY8058281,/home/ysun4/testSinglecell/ExternalData/5705STDY8058281_filtered_feature_bc_matrix.h5,Female,Everything
5705STDY8058282,/home/ysun4/testSinglecell/ExternalData/5705STDY8058282_filtered_feature_bc_matrix.h5,Female,Everything
5705STDY8058283,/home/ysun4/testSinglecell/ExternalData/5705STDY8058283_filtered_feature_bc_matrix.h5,Male,Everything
5705STDY8058284,/home/ysun4/testSinglecell/ExternalData/5705STDY8058284_filtered_feature_bc_matrix.h5,Male,Everything
5705STDY8058285,/home/ysun4/testSinglecell/ExternalData/5705STDY8058285_filtered_feature_bc_matrix.h5,Male,Everything</code></pre>
<p>We prepare the DEGinfo.csv file in this way. The <em>cluster</em> column has ‘SelectAll’, and since it only has one value, it actually selects all cells when running the pipeline. Then it performs <strong>astrocytes</strong> to <strong>Oligos</strong> comparison.</p>
<pre><code>sample,cluster,group,alt,ref,covars[+ separated],method[default NEBULA],model[default HL]
library_id,SelectAll,predicted.celltype1,astrocytes,Oligos,,NEBULA,HL</code></pre>
<p>Then we need to run the scRNASequest pipeline from the beginning, which allows the ‘SelectAll’ column to be embedded into the harmonized h5ad output. As long as we have DEGinfo.csv included in the config.yml, it will run through the DE analysis and produce the following results:</p>
<pre><code>outputdir
    ... previous results         #Omitted, see section 6.4
    ├── ProjName_scDEG           #Folder containing DEG results
      ├── deg6602_SelectAll_predicted.celltype1_NEBULA_HL
        ├── astrocytes.vs.Oligos_SelectAll:Everything_NEBULA.csv    #Each comparison has three associated files
        ├── astrocytes.vs.Oligos_SelectAll:Everything_NEBULA.png
        ├── astrocytes.vs.Oligos_SelectAll:Everything_NEBULA.QC.pdf
        ├── env.rds
    ├── ProjName_scDEG.cmd.json
    ├── deg6602_SelectAll_predicted.celltype1_NEBULA_HL_Everything_astrocytes_Oligos.error  #Standard error messages
    └── ProjName_scDEG.db</code></pre>
<p>An example of the DE csv table (astrocytes.vs.Oligos_SelectAll:Everything_NEBULA.csv, top 5 rows):</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-8">Table 7.2: </span>DEG analysis of astrocytes.vs.Oligos
</caption>
<thead>
<tr>
<th style="text-align:center;">
res.tab.ID
</th>
<th style="text-align:center;">
res.tab.log2FC
</th>
<th style="text-align:center;">
res.tab.Pvalue
</th>
<th style="text-align:center;">
res.tab.FDR
</th>
<th style="text-align:center;">
res.tab.algorithm
</th>
<th style="text-align:center;">
res.tab.convergence
</th>
<th style="text-align:center;">
res.tab.metric
</th>
<th style="text-align:center;">
res.ls.summary.logFC_.Intercept.
</th>
<th style="text-align:center;">
res.ls.summary.logFC_.GrouPalt
</th>
<th style="text-align:center;">
res.ls.summary.se_.Intercept.
</th>
<th style="text-align:center;">
res.ls.summary.se_.GrouPalt
</th>
<th style="text-align:center;">
res.ls.summary.p_.Intercept.
</th>
<th style="text-align:center;">
res.ls.summary.p_.GrouPalt
</th>
<th style="text-align:center;">
res.ls.summary.gene_id
</th>
<th style="text-align:center;">
res.ls.summary.gene
</th>
<th style="text-align:center;">
res.ls.overdispersion.Subject
</th>
<th style="text-align:center;">
res.ls.overdispersion.Cell
</th>
<th style="text-align:center;">
res.ls.convergence
</th>
<th style="text-align:center;">
res.ls.algorithm
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Xkr4
</td>
<td style="text-align:center;">
-3.327923
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4177.156
</td>
<td style="text-align:center;">
-8.168075
</td>
<td style="text-align:center;">
-2.3067403
</td>
<td style="text-align:center;">
0.0367924
</td>
<td style="text-align:center;">
0.0561022
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Xkr4
</td>
<td style="text-align:center;">
0.0067297
</td>
<td style="text-align:center;">
0.6076303
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Rgs20
</td>
<td style="text-align:center;">
6.386205
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
5561.771
</td>
<td style="text-align:center;">
-9.825703
</td>
<td style="text-align:center;">
-2.5066029
</td>
<td style="text-align:center;">
0.0890548
</td>
<td style="text-align:center;">
0.1353916
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Gm1992
</td>
<td style="text-align:center;">
0.0398103
</td>
<td style="text-align:center;">
1.4947561
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
St18
</td>
<td style="text-align:center;">
-5.129500
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
14283.487
</td>
<td style="text-align:center;">
-10.322696
</td>
<td style="text-align:center;">
0.2176484
</td>
<td style="text-align:center;">
0.0310922
</td>
<td style="text-align:center;">
0.0690489
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0016211
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
Mrpl15
</td>
<td style="text-align:center;">
0.0001000
</td>
<td style="text-align:center;">
0.4188721
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Adhfe1
</td>
<td style="text-align:center;">
4.842192
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
12162.136
</td>
<td style="text-align:center;">
-10.169996
</td>
<td style="text-align:center;">
0.1119117
</td>
<td style="text-align:center;">
0.0292679
</td>
<td style="text-align:center;">
0.0669762
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0947381
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
Tcea1
</td>
<td style="text-align:center;">
0.0001000
</td>
<td style="text-align:center;">
0.7212448
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
<tr>
<td style="text-align:center;">
Prex2
</td>
<td style="text-align:center;">
8.368190
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
HL
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
8249.837
</td>
<td style="text-align:center;">
-10.292221
</td>
<td style="text-align:center;">
4.4265797
</td>
<td style="text-align:center;">
0.0513462
</td>
<td style="text-align:center;">
0.0563860
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
Rgs20
</td>
<td style="text-align:center;">
0.0047768
</td>
<td style="text-align:center;">
0.4563594
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
NBGMM (HL)
</td>
</tr>
</tbody>
</table>
</div>
<p>An example of the DE png file (astrocytes.vs.Oligos_SelectAll:Everything_NEBULA.png):</p>
<p><a href="https://interactivereport.github.io/scRNAsequest/tutorial/images/DEG_Astrocytes_Oligos.png"><img src="https://interactivereport.github.io/scRNAsequest/tutorial/images/DEG_Astrocytes_Oligos.png" /></a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="running-the-pipeline.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reference-building.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/interactivereport/scRNAsequest/edit/gh-pages/07-DEAnalysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/interactivereport/scRNAsequest/blob/gh-pages/07-DEAnalysis.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
